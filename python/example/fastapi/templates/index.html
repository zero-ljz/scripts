<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>{{ title }}</title>
  <style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f7f7f7;
}

h1 {
  color: #2c3e50;
}

section {
  background: white;
  padding: 15px;
  margin-bottom: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

form input {
  margin: 5px;
  padding: 8px;
}

button {
  padding: 8px 12px;
  background: #3498db;
  color: white;
  border: none;
  border-radius: 5px;
}

button:hover {
  background: #2980b9;
}

ul {
  list-style: none;
  padding: 0;
}


  </style>
</head>
<body>
  <h1>ğŸš€ FastAPI Demo</h1>

  <section>
    <h2>ç”¨æˆ·ç™»å½•</h2>
    <form id="loginForm">
      <input type="text" id="username" placeholder="ç”¨æˆ·å" required>
      <input type="password" id="password" placeholder="å¯†ç " required>
      <button type="submit">ç™»å½•</button>
    </form>
    <p id="loginStatus"></p>
  </section>

  <section>
    <h2>æ·»åŠ  Item</h2>
    <form id="itemForm">
      <input type="text" id="name" placeholder="åç§°" required>
      <input type="text" id="description" placeholder="æè¿°">
      <input type="number" id="price" step="0.01" placeholder="ä»·æ ¼" required>
      <input type="text" id="tags" placeholder="æ ‡ç­¾(é€—å·åˆ†éš”)">
      <button type="submit">æ·»åŠ </button>
    </form>
  </section>

  <section>
    <h2>å·²æœ‰ Items</h2>
    <ul id="itemsList"></ul>
  </section>

  <script>
    let token = null;

    // ç™»å½•
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      const res = await fetch("/login/", {
        method: "POST",
        headers: {"Content-Type": "application/x-www-form-urlencoded"},
        body: `username=${username}&password=${password}`
      });

      const data = await res.json();
      if (res.ok) {
        token = data.token;
        document.getElementById("loginStatus").innerText = "âœ… ç™»å½•æˆåŠŸï¼Token å·²ä¿å­˜";
      } else {
        document.getElementById("loginStatus").innerText = "âŒ ç™»å½•å¤±è´¥: " + data.message;
      }
    });

    // æ·»åŠ  Item
    document.getElementById("itemForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!token) {
        alert("è¯·å…ˆç™»å½•è·å– tokenï¼");
        return;
      }

      const item = {
        name: document.getElementById("name").value,
        description: document.getElementById("description").value,
        price: parseFloat(document.getElementById("price").value),
        tags: document.getElementById("tags").value.split(",").map(t => t.trim()).filter(Boolean)
      };

      const res = await fetch("/items/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "token": token
        },
        body: JSON.stringify(item)
      });

      const data = await res.json();
      if (res.ok) {
        alert("âœ… æ·»åŠ æˆåŠŸï¼");
        loadItems();
      } else {
        alert("âŒ æ·»åŠ å¤±è´¥: " + data.error);
      }
    });

    // åŠ è½½ Item åˆ—è¡¨
    async function loadItems() {
      const res = await fetch("/items/");
      const data = await res.json();
      const list = document.getElementById("itemsList");
      list.innerHTML = "";
      data.forEach(item => {
        const li = document.createElement("li");
        li.innerText = `${item.id}. ${item.name} - ï¿¥${item.price} [${item.tags.join(", ")}]`;
        list.appendChild(li);
      });
    }

    // é¡µé¢åŠ è½½æ—¶è·å–å·²æœ‰ items
    loadItems();
  </script>
</body>
</html>
